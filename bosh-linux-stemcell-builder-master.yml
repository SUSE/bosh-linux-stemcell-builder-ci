---
jobs:
  #
  # Pipeline won't automatically build if src changes, need to
  # run increase-stemcell-version manually first to increase the stemcell version
  #
  - name: increase-stemcell-version
    serial: true
    plan:
      - get: semver.bosh-stemcell
        params:
          bump: major
      - put: semver.bosh-stemcell
        params:
          file: semver.bosh-stemcell/number

  - name: build-os-image-ubuntu-trusty
    serial_groups: [ubuntu]
    plan:
      - aggregate:
        - get: src
        - get: ci
        - put: semver.os-image-ubuntu
          params:
            bump: minor
      - task: build-os-image
        file: ci/tasks/build-os-image-ubuntu-centos.yml
        privileged: true
        params:
          OPERATING_SYSTEM_NAME:      ubuntu
          OPERATING_SYSTEM_VERSION:   trusty
      - aggregate:
        - put: s3.ubuntu-trusty-os-image
          params:
            file: os-image/ubuntu-trusty.tgz
            acl: public-read
        - put: docker.ubuntu-os-image
          params:
            tag_prefix: "trusty-"
            tag: semver.os-image-ubuntu/number
            import_file: os-image/ubuntu-trusty.tgz
            tag_as_latest: true
          get_params:
            skip_download: true

  - name: build-fissile-stemcell-ubuntu-trusty
    serial_groups: [ubuntu]
    plan:
      - aggregate:
        - get: ci
          passed:
            - build-os-image-ubuntu-trusty
        - get: docker.ubuntu-os-image
          trigger: true
          passed:
            - build-os-image-ubuntu-trusty
        - get: git.fissile-stemcell-ubuntu
          trigger: true
        - get: semver.os-image-ubuntu
          passed:
            - build-os-image-ubuntu-trusty
      - task: setup-ubuntu-stemcell-versions
        file: ci/tasks/setup-ubuntu-stemcell-versions.yml
        input_mapping:
          src: git.fissile-stemcell-ubuntu
        params:
          DOCKER_REPOSITORY: os-image-ubuntu
      - put: docker.fissile-stemcell-ubuntu
        params:
          build: versioned-fissile-stemcell-ubuntu
          tag: versioned-fissile-stemcell-ubuntu/VERSION
        get_params:
          skip_download: true

  - name: build-os-image-opensuse-leap
    serial_groups: [opensuse]
    plan:
      - aggregate:
        - get: src
        - get: ci
        - put: semver.os-image-opensuse
          params:
            bump: minor
        - get: lftp.os-image-opensuse
          trigger: true
      - task: build
        file: ci/tasks/build-os-image-opensuse.yml
        privileged: true
        params:
          OPERATING_SYSTEM_NAME:      opensuse
          OPERATING_SYSTEM_VERSION:   leap
      - aggregate:
        - put: s3.opensuse-leap-os-image
          params:
            file: os-image/opensuse-leap.tgz
            acl: public-read
        - put: docker.opensuse-os-image
          params:
            tag_prefix: "42.2-"
            tag: semver.os-image-opensuse/number
            import_file: os-image/opensuse-leap.tgz
            tag_as_latest: true
          get_params:
            skip_download: true

  - name: build-fissile-stemcell-opensuse-leap
    serial_groups: [opensuse]
    plan:
      - aggregate:
        - get: ci
          passed:
            - build-os-image-opensuse-leap
        - get: docker.opensuse-os-image
          trigger: true
          passed:
            - build-os-image-opensuse-leap
        - get: git.fissile-stemcell-opensuse
          trigger: true
        - get: semver.os-image-opensuse
          passed:
            - build-os-image-opensuse-leap
      - task: setup-opensuse-stemcell-versions
        file: ci/tasks/setup-opensuse-stemcell-versions.yml
        input_mapping:
          src: git.fissile-stemcell-opensuse
        params:
          DOCKER_REPOSITORY: os-image-opensuse
      - put: docker.fissile-stemcell-opensuse
        params:
          build: versioned-fissile-stemcell-opensuse
          tag: versioned-fissile-stemcell-opensuse/VERSION
          build_args:
            base_image: splatform/os-image-opensuse:42.2
            configgin_version: 0.14.0
        get_params:
          skip_download: true
      - put: email.suse
        params:
          subject_text: "openSUSE Fissile stemcell was updated"
          body_text: "View reason for the last build: https://build.opensuse.org/packages/os-image-opensuse/build_reason/Cloud:Platform:os-image:openSUSE/images/x86_64"

  - name: build-os-image-sle12
    serial_groups: [sles]
    plan:
      - aggregate:
        - get: src
        - get: ci
        - put: semver.os-image-sle12
          params:
            bump: minor
        - get: lftp.os-image-sle12
          trigger: true
      - task: build
        file: ci/tasks/build-os-image-opensuse.yml
        privileged: true
        params:
          OPERATING_SYSTEM_NAME:      sles
          OPERATING_SYSTEM_VERSION:   12
      - aggregate:
        - put: s3.sles-12-os-image
          params:
            file: os-image/sles-12.tgz
            acl: public-read
        - put: docker.sles-os-image
          params:
            tag_prefix: "12-"
            tag: semver.os-image-sle12/number
            import_file: os-image/sles-12.tgz
            tag_as_latest: true
          get_params:
            skip_download: true

  - name: build-fissile-stemcell-sles-12
    serial_groups: [sles]
    plan:
      - aggregate:
        - get: ci
          passed:
            - build-os-image-sle12
        - get: docker.sles-os-image
          trigger: true
          passed:
            - build-os-image-sle12
        - get: git.fissile-stemcell-sles
          trigger: true
        - get: semver.os-image-sle12
          passed:
            - build-os-image-sle12
      - task: setup-sles-stemcell-versions
        file: ci/tasks/setup-sles-stemcell-versions.yml
        input_mapping:
          src: git.fissile-stemcell-sles
        params:
          DOCKER_REPOSITORY: os-image-sle12
      - put: docker.fissile-stemcell-sles
        params:
          build: versioned-fissile-stemcell-sles
          tag: versioned-fissile-stemcell-sles/VERSION
          build_args:
            base_image: ((docker-internal-registry))/splatform/os-image-sle12
            configgin_version: 0.14.0
        get_params:
          skip_download: true
      - put: email.suse
        params:
          subject_text: "SLE Fissile stemcell was updated"
          body_text: "View reason for the last build: https://build.opensuse.org/packages/os-image-sle/build_reason/Cloud:Platform:os-image:SLE/images/x86_64"

  #
  # openstack
  #

  - name: build-openstack-kvm-ubuntu-trusty
    serial_groups: [ubuntu]
    plan:
      - aggregate:
        - get: semver.bosh-stemcell
          passed: [increase-stemcell-version]
        - get: ci
          passed: [build-os-image-ubuntu-trusty]
        - get: src
          passed: [build-os-image-ubuntu-trusty]
        - get: bosh-io-release.bosh
        - get: os-image
          resource: s3.ubuntu-trusty-os-image
          trigger: true
          passed: [build-os-image-ubuntu-trusty]
      - task: build
        file: ci/tasks/build-stemcell.yml
        privileged: true
        params:
          IAAS:       openstack
          HYPERVISOR: kvm
          OS_NAME:    ubuntu
          OS_VERSION: trusty
          OS_IMAGE_BUCKET: concourse-bosh-image
      - aggregate:
        - put: s3.openstack-kvm-ubuntu-trusty
          params:
            file: stemcell/*-go_agent.tgz


  - name: build-openstack-kvm-opensuse-leap
    serial_groups: [opensuse]
    plan:
      - aggregate:
        - get: semver.bosh-stemcell
        - get: ci
          passed: [build-os-image-opensuse-leap]
        - get: src
          passed: [build-os-image-opensuse-leap]
        - get: bosh-io-release.bosh
        - get: os-image
          resource: s3.opensuse-leap-os-image
          trigger: true
          passed: [build-os-image-opensuse-leap]
      - task: build
        file: ci/tasks/build-stemcell.yml
        privileged: true
        params:
          IAAS:       openstack
          HYPERVISOR: kvm
          OS_NAME:    opensuse
          OS_VERSION: leap
          OS_IMAGE_BUCKET: concourse-bosh-image
      - aggregate:
        - put: s3.openstack-kvm-opensuse-leap
          params:
            file: stemcell/*-go_agent.tgz


  #
  # AWS
  #

  - name: build-aws-xen-ubuntu-trusty
    serial_groups: [ubuntu]
    plan:
      - aggregate:
        - get: semver.bosh-stemcell
          passed: [increase-stemcell-version]
        - get: ci
          passed: [build-os-image-ubuntu-trusty]
        - get: src
          passed: [build-os-image-ubuntu-trusty]
        - get: bosh-io-release.bosh
        - get: os-image
          resource: s3.ubuntu-trusty-os-image
          trigger: true
          passed: [build-os-image-ubuntu-trusty]
      - task: build
        file: ci/tasks/build-stemcell.yml
        privileged: true
        params:
          IAAS:       aws
          HYPERVISOR: xen
          OS_NAME:    ubuntu
          OS_VERSION: trusty
          OS_IMAGE_BUCKET: concourse-bosh-image
      - aggregate:
        - put: s3.aws-xen-ubuntu-trusty
          params:
            file: stemcell/*-go_agent.tgz

  - name: build-aws-xen-opensuse-leap
    serial_groups: [opensuse]
    plan:
      - aggregate:
        - get: semver.bosh-stemcell
          passed: [increase-stemcell-version]
        - get: ci
          passed: [build-os-image-opensuse-leap]
        - get: src
          passed: [build-os-image-opensuse-leap]
        - get: bosh-io-release.bosh
        - get: os-image
          resource: s3.opensuse-leap-os-image
          trigger: true
          passed: [build-os-image-opensuse-leap]
      - task: build
        file: ci/tasks/build-stemcell.yml
        privileged: true
        params:
          IAAS:       aws
          HYPERVISOR: xen
          OS_NAME:    opensuse
          OS_VERSION: leap
          OS_IMAGE_BUCKET: concourse-bosh-image
      - aggregate:
        - put: s3.aws-xen-opensuse-leap
          params:
            file: stemcell/*-go_agent.tgz

  #
  # Azure
  #

  - name: build-azure-hyperv-ubuntu-trusty
    serial_groups: [ubuntu]
    plan:
      - aggregate:
        - get: semver.bosh-stemcell
          passed: [increase-stemcell-version]
        - get: ci
          passed: [build-os-image-ubuntu-trusty]
        - get: src
          passed: [build-os-image-ubuntu-trusty]
        - get: bosh-io-release.bosh
        - get: os-image
          resource: s3.ubuntu-trusty-os-image
          trigger: true
          passed: [build-os-image-ubuntu-trusty]
      - task: build
        file: ci/tasks/build-stemcell.yml
        privileged: true
        params:
          IAAS:       azure
          HYPERVISOR: hyperv
          OS_NAME:    ubuntu
          OS_VERSION: trusty
          OS_IMAGE_BUCKET: concourse-bosh-image
      - aggregate:
        - put: s3.azure-hyperv-ubuntu-trusty
          params:
            file: stemcell/*-go_agent.tgz

  - name: build-azure-hyperv-opensuse-leap
    serial_groups: [opensuse]
    plan:
      - aggregate:
        - get: semver.bosh-stemcell
          passed: [increase-stemcell-version]
        - get: ci
          passed: [build-os-image-opensuse-leap]
        - get: src
          passed: [build-os-image-opensuse-leap]
        - get: bosh-io-release.bosh
        - get: os-image
          resource: s3.opensuse-leap-os-image
          trigger: true
          passed: [build-os-image-opensuse-leap]
      - task: build
        file: ci/tasks/build-stemcell.yml
        privileged: true
        params:
          IAAS:       azure
          HYPERVISOR: hyperv
          OS_NAME:    opensuse
          OS_VERSION: leap
          OS_IMAGE_BUCKET: concourse-bosh-image
      - aggregate:
        - put: s3.azure-hyperv-opensuse-leap
          params:
            file: stemcell/*-go_agent.tgz

  #
  # google
  #

  - name: build-google-kvm-ubuntu-trusty
    serial_groups: [ubuntu]
    plan:
      - aggregate:
        - get: semver.bosh-stemcell
          passed: [increase-stemcell-version]
        - get: ci
          passed: [build-os-image-ubuntu-trusty]
        - get: src
          passed: [build-os-image-ubuntu-trusty]
        - get: bosh-io-release.bosh
        - get: os-image
          resource: s3.ubuntu-trusty-os-image
          trigger: true
          passed: [build-os-image-ubuntu-trusty]
      - task: build
        file: ci/tasks/build-stemcell.yml
        privileged: true
        params:
          IAAS:       google
          HYPERVISOR: kvm
          OS_NAME:    ubuntu
          OS_VERSION: trusty
          OS_IMAGE_BUCKET: concourse-bosh-image
      - aggregate:
        - put: s3.google-kvm-ubuntu-trusty
          params:
            file: stemcell/*-go_agent.tgz


  - name: build-google-kvm-opensuse-leap
    serial_groups: [opensuse]
    plan:
      - aggregate:
        - get: semver.bosh-stemcell
          passed: [increase-stemcell-version]
        - get: ci
          passed: [build-os-image-opensuse-leap]
        - get: src
          passed: [build-os-image-opensuse-leap]
        - get: bosh-io-release.bosh
        - get: os-image
          resource: s3.opensuse-leap-os-image
          trigger: true
          passed: [build-os-image-opensuse-leap]
      - task: build
        file: ci/tasks/build-stemcell.yml
        privileged: true
        params:
          IAAS:       google
          HYPERVISOR: kvm
          OS_NAME:    opensuse
          OS_VERSION: leap
          OS_IMAGE_BUCKET: concourse-bosh-image
      - aggregate:
        - put: s3.google-kvm-opensuse-leap
          params:
            file: stemcell/*-go_agent.tgz


  #
  # vsphere
  #

  - name: build-vsphere-esxi-ubuntu-trusty
    serial_groups: [ubuntu]
    plan:
      - aggregate:
        - get: semver.bosh-stemcell
          passed: [increase-stemcell-version]
        - get: ci
          passed: [build-os-image-ubuntu-trusty]
        - get: src
          passed: [build-os-image-ubuntu-trusty]
        - get: bosh-io-release.bosh
        - get: os-image
          resource: s3.ubuntu-trusty-os-image
          trigger: true
          passed: [build-os-image-ubuntu-trusty]
      - task: build
        file: ci/tasks/build-stemcell.yml
        privileged: true
        params:
          IAAS:       vsphere
          HYPERVISOR: esxi
          OS_NAME:    ubuntu
          OS_VERSION: trusty
          OS_IMAGE_BUCKET: concourse-bosh-image
      - aggregate:
        - put: s3.vsphere-esxi-ubuntu-trusty
          params:
            file: stemcell/*-go_agent.tgz


  - name: build-vsphere-esxi-opensuse-leap
    serial_groups: [opensuse]
    plan:
      - aggregate:
        - get: semver.bosh-stemcell
          passed: [increase-stemcell-version]
        - get: ci
          passed: [build-os-image-opensuse-leap]
        - get: src
          passed: [build-os-image-opensuse-leap]
        - get: bosh-io-release.bosh
        - get: os-image
          resource: s3.opensuse-leap-os-image
          trigger: true
          passed: [build-os-image-opensuse-leap]
      - task: build
        file: ci/tasks/build-stemcell.yml
        privileged: true
        params:
          IAAS:       vsphere
          HYPERVISOR: esxi
          OS_NAME:    opensuse
          OS_VERSION: leap
          OS_IMAGE_BUCKET: concourse-bosh-image
      - aggregate:
        - put: s3.vsphere-esxi-opensuse-leap
          params:
            file: stemcell/*-go_agent.tgz

resource_types:
- name: lftp-resource
  type: docker-image
  source:
    repository: machinerytool/concourse-lftp-resource
    tag: latest

- name: email
  type: docker-image
  source:
    repository: pcfseceng/email-resource

resources:
  - name: email.suse
    type: email
    source:
      smtp:
        anonymous: true
        host: imap.suse.de
        port: "587"
        ca_cert: |
          -----BEGIN CERTIFICATE-----
          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
          -----END CERTIFICATE-----
      from: "cf-ci-bot@suse.de"
      to: [ "team-alfred@suse.de" ]

  - name: lftp.os-image-sle12
    type: lftp-resource
    source:
      url: https://download.opensuse.org/repositories/Cloud:/Platform:/os-image:/SLE/images/
      regexp: SLES12-SP3.x86_64-1.42.2-Build(.*).tbz

  - name: lftp.os-image-opensuse
    type: lftp-resource
    source:
      url: https://download.opensuse.org/repositories/Cloud:/Platform:/os-image:/openSUSE/images/
      regexp: Leap-42.1.x86_64-1.42.2-Build(.*).tbz

  - name: ci
    type: git
    source:
      uri: git@github.com:SUSE/bosh-linux-stemcell-builder-ci.git
      branch: master
      private_key: {{github-private-key}}

  - name: src
    type: git
    source:
      uri: git@github.com:SUSE/bosh-linux-stemcell-builder.git
      branch: merged_stemcells
      private_key: {{github-private-key}}

  - name: git.fissile-stemcell-opensuse
    type: git
    source:
      uri: https://github.com/SUSE/fissile-stemcell-openSUSE.git
      branch: 42.2

  - name: git.fissile-stemcell-sles
    type: git
    source:
      uri: https://github.com/SUSE/fissile-stemcell-sle.git
      branch: master

  - name: git.fissile-stemcell-ubuntu
    type: git
    source:
      uri: https://github.com/cloudfoundry-community/fissile-stemcell-ubuntu.git
      branch: trusty

  - name: semver.os-image-opensuse
    type: semver
    source:
      driver: s3
      key: os-image-opensuse-leap-version
      bucket: concourse-bosh-image
      access_key_id: {{aws-access-key}}
      secret_access_key: {{aws-secret-key}}
      region_name: eu-central-1
      initial_version: 0.0.0

  - name: semver.os-image-sle12
    type: semver
    source:
      driver: s3
      key: os-image-sle12-version
      bucket: concourse-bosh-image
      access_key_id: {{aws-access-key}}
      secret_access_key: {{aws-secret-key}}
      region_name: eu-central-1
      initial_version: 0.0.0

  - name: semver.os-image-ubuntu
    type: semver
    source:
      driver: s3
      key: os-image-ubuntu-trusty-version
      bucket: concourse-bosh-image
      access_key_id: {{aws-access-key}}
      secret_access_key: {{aws-secret-key}}
      region_name: eu-central-1
      initial_version: 0.0.0

  - name: semver.bosh-stemcell
    type: semver
    source:
      driver: s3
      key: bosh-stemcell/version
      bucket: concourse-bosh-stemcell
      access_key_id: {{aws-access-key}}
      secret_access_key: {{aws-secret-key}}
      region_name: eu-central-1

  #
  # ubuntu-trusty
  #

  - name: s3.ubuntu-trusty-os-image
    type: s3
    source:
      bucket: concourse-bosh-image
      versioned_file: bosh-ubuntu-trusty-os-image.tgz
      access_key_id: {{aws-access-key}}
      secret_access_key: {{aws-secret-key}}
      region_name: eu-central-1

  - name: s3.openstack-kvm-ubuntu-trusty
    type: s3
    source:
      bucket: concourse-bosh-stemcell
      regexp: bosh-stemcell-candidate/openstack/bosh-stemcell-(.+)-openstack-kvm-ubuntu-trusty-go_agent.tgz
      access_key_id: {{aws-access-key}}
      secret_access_key: {{aws-secret-key}}
      region_name: eu-central-1

  - name: s3.aws-xen-ubuntu-trusty
    type: s3
    source:
      bucket: concourse-bosh-stemcell
      regexp: bosh-stemcell-candidate/aws/bosh-stemcell-(.+)-aws-xen-ubuntu-trusty-go_agent.tgz
      access_key_id: {{aws-access-key}}
      secret_access_key: {{aws-secret-key}}
      region_name: eu-central-1

  - name: s3.azure-hyperv-ubuntu-trusty
    type: s3
    source:
      bucket: concourse-bosh-stemcell
      regexp: bosh-stemcell-candidate/hyperv/bosh-stemcell-(.+)-azure-hyperv-ubuntu-trusty-go_agent.tgz
      access_key_id: {{aws-access-key}}
      secret_access_key: {{aws-secret-key}}
      region_name: eu-central-1

  - name: s3.google-kvm-ubuntu-trusty
    type: s3
    source:
      bucket: concourse-bosh-stemcell
      regexp: bosh-stemcell-candidate/google/bosh-stemcell-(.+)-google-kvm-ubuntu-trusty-go_agent.tgz
      access_key_id: {{aws-access-key}}
      secret_access_key: {{aws-secret-key}}
      region_name: eu-central-1

  - name: s3.vsphere-esxi-ubuntu-trusty
    type: s3
    source:
      bucket: concourse-bosh-stemcell
      regexp: bosh-stemcell-candidate/google/bosh-stemcell-(.+)-vsphere-esxi-ubuntu-trusty-go_agent.tgz
      access_key_id: {{aws-access-key}}
      secret_access_key: {{aws-secret-key}}
      region_name: eu-central-1

  - name: docker.ubuntu-os-image
    type: docker-image
    source:
      repository: splatform/os-image-ubuntu
      tag: trusty
      username: {{docker-username}}
      password: {{docker-password}}

  - name: docker.fissile-stemcell-ubuntu
    type: docker-image
    source:
      repository: splatform/fissile-stemcell-ubuntu
      tag: trusty
      username: {{docker-username}}
      password: {{docker-password}}

  #
  # opensuse
  #

  - name: s3.opensuse-leap-os-image
    type: s3
    source:
      bucket: concourse-bosh-image
      versioned_file: bosh-opensuse-leap-os-image.tgz
      access_key_id: {{aws-access-key}}
      secret_access_key: {{aws-secret-key}}
      region_name: eu-central-1

  - name: s3.openstack-kvm-opensuse-leap
    type: s3
    source:
      bucket: concourse-bosh-stemcell
      regexp: bosh-stemcell-candidate/openstack/bosh-stemcell-(.+)-openstack-kvm-opensuse-leap-go_agent.tgz
      access_key_id: {{aws-access-key}}
      secret_access_key: {{aws-secret-key}}
      region_name: eu-central-1

  - name: s3.aws-xen-opensuse-leap
    type: s3
    source:
      bucket: concourse-bosh-stemcell
      regexp: bosh-stemcell-candidate/aws/bosh-stemcell-(.+)-aws-xen-opensuse-leap-go_agent.tgz
      access_key_id: {{aws-access-key}}
      secret_access_key: {{aws-secret-key}}
      region_name: eu-central-1

  - name: s3.azure-hyperv-opensuse-leap
    type: s3
    source:
      bucket: concourse-bosh-stemcell
      regexp: bosh-stemcell-candidate/hyperv/bosh-stemcell-(.+)-azure-hyperv-opensuse-leap-go_agent.tgz
      access_key_id: {{aws-access-key}}
      secret_access_key: {{aws-secret-key}}
      region_name: eu-central-1

  - name: s3.google-kvm-opensuse-leap
    type: s3
    source:
      bucket: concourse-bosh-stemcell
      regexp: bosh-stemcell-candidate/google/bosh-stemcell-(.+)-google-kvm-opensuse-leap-go_agent.tgz
      access_key_id: {{aws-access-key}}
      secret_access_key: {{aws-secret-key}}
      region_name: eu-central-1

  - name: s3.vsphere-esxi-opensuse-leap
    type: s3
    source:
      bucket: concourse-bosh-stemcell
      regexp: bosh-stemcell-candidate/google/bosh-stemcell-(.+)-vsphere-esxi-opensuse-leap-go_agent.tgz
      access_key_id: {{aws-access-key}}
      secret_access_key: {{aws-secret-key}}
      region_name: eu-central-1

  - name: docker.opensuse-os-image
    type: docker-image
    source:
      repository: splatform/os-image-opensuse
      username: {{docker-username}}
      password: {{docker-password}}

  - name: docker.fissile-stemcell-opensuse
    type: docker-image
    source:
      repository: splatform/fissile-stemcell-opensuse
      username: {{docker-username}}
      password: {{docker-password}}

  #
  # sles
  #

  - name: s3.sles-12-os-image
    type: s3
    source:
      bucket: concourse-bosh-image
      versioned_file: bosh-sles-12-os-image.tgz
      access_key_id: {{aws-access-key}}
      secret_access_key: {{aws-secret-key}}
      region_name: eu-central-1

  - name: docker.sles-os-image
    type: docker-image
    source:
      repository: {{docker-internal-os-image}}
      username: {{docker-internal-username}}
      password: {{docker-internal-password}}

  - name: docker.fissile-stemcell-sles
    type: docker-image
    source:
      repository: {{docker-internal-fissile-image}}
      username: {{docker-internal-username}}
      password: {{docker-internal-password}}

  #
  # bosh releases
  #
  - name: bosh-io-release.bosh
    type: bosh-io-release
    source:
      repository: cloudfoundry/bosh
